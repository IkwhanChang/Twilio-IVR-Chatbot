{"ast":null,"code":"import _classCallCheck from '../../polyfills/classCallCheck';\nimport _createClass from '../../polyfills/createClass';\nimport { getData, getSanitizedData, intersect } from '..';\nimport { uncompress } from '../data';\nimport store from '../store';\n\nvar NimbleEmojiIndex = function () {\n  function NimbleEmojiIndex(data, set) {\n    _classCallCheck(this, NimbleEmojiIndex);\n\n    if (data.compressed) {\n      uncompress(data);\n    }\n\n    this.data = data || {};\n    this.set = set || null;\n    this.originalPool = {};\n    this.index = {};\n    this.emojis = {};\n    this.emoticons = {};\n    this.customEmojisList = [];\n    this.buildIndex();\n  }\n\n  _createClass(NimbleEmojiIndex, [{\n    key: 'buildIndex',\n    value: function buildIndex() {\n      var _this = this;\n\n      var _loop = function _loop(emoji) {\n        var emojiData = _this.data.emojis[emoji];\n        var short_names = emojiData.short_names;\n        var emoticons = emojiData.emoticons;\n        var skin_variations = emojiData.skin_variations;\n        var id = short_names[0];\n\n        if (emoticons) {\n          emoticons.forEach(function (emoticon) {\n            if (_this.emoticons[emoticon]) {\n              return;\n            }\n\n            _this.emoticons[emoticon] = id;\n          });\n        } // If skin variations include them\n\n\n        if (skin_variations) {\n          _this.emojis[id] = {};\n\n          for (var skinTone = 1; skinTone <= 6; skinTone++) {\n            _this.emojis[id][skinTone] = getSanitizedData({\n              id: id,\n              skin: skinTone\n            }, skinTone, _this.set, _this.data);\n          }\n        } else {\n          _this.emojis[id] = getSanitizedData(id, null, _this.set, _this.data);\n        }\n\n        _this.originalPool[id] = emojiData;\n      };\n\n      for (var emoji in this.data.emojis) {\n        _loop(emoji);\n      }\n    }\n  }, {\n    key: 'clearCustomEmojis',\n    value: function clearCustomEmojis(pool) {\n      var _this2 = this;\n\n      this.customEmojisList.forEach(function (emoji) {\n        var emojiId = emoji.id || emoji.short_names[0];\n        delete pool[emojiId];\n        delete _this2.emojis[emojiId];\n      });\n    }\n  }, {\n    key: 'addCustomToPool',\n    value: function addCustomToPool(custom, pool) {\n      var _this3 = this;\n\n      if (this.customEmojisList.length) this.clearCustomEmojis(pool);\n      custom.forEach(function (emoji) {\n        var emojiId = emoji.id || emoji.short_names[0];\n\n        if (emojiId && !pool[emojiId]) {\n          pool[emojiId] = getData(emoji, null, null, _this3.data);\n          _this3.emojis[emojiId] = getSanitizedData(emoji, null, null, _this3.data);\n        }\n      });\n      this.customEmojisList = custom;\n      this.index = {};\n    }\n  }, {\n    key: 'search',\n    value: function search(value) {\n      var _this4 = this;\n\n      var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n      var emojisToShowFilter = _ref.emojisToShowFilter;\n      var maxResults = _ref.maxResults;\n      var include = _ref.include;\n      var exclude = _ref.exclude;\n      var _ref$custom = _ref.custom;\n      var custom = _ref$custom === undefined ? [] : _ref$custom;\n      if (this.customEmojisList != custom) this.addCustomToPool(custom, this.originalPool);\n      var skinTone = store.get('skin') || 1;\n      maxResults || (maxResults = 75);\n      include || (include = []);\n      exclude || (exclude = []);\n      var results = null,\n          pool = this.originalPool;\n\n      if (value.length) {\n        if (value == '-' || value == '-1') {\n          return [this.emojis['-1'][skinTone]];\n        }\n\n        var values = value.toLowerCase().split(/[\\s|,|\\-|_]+/),\n            allResults = [];\n\n        if (values.length > 2) {\n          values = [values[0], values[1]];\n        }\n\n        if (include.length || exclude.length) {\n          pool = {};\n          this.data.categories.forEach(function (category) {\n            var isIncluded = include && include.length ? include.indexOf(category.id) > -1 : true;\n            var isExcluded = exclude && exclude.length ? exclude.indexOf(category.id) > -1 : false;\n\n            if (!isIncluded || isExcluded) {\n              return;\n            }\n\n            category.emojis.forEach(function (emojiId) {\n              return pool[emojiId] = _this4.data.emojis[emojiId];\n            });\n          });\n\n          if (custom.length) {\n            var customIsIncluded = include && include.length ? include.indexOf('custom') > -1 : true;\n            var customIsExcluded = exclude && exclude.length ? exclude.indexOf('custom') > -1 : false;\n\n            if (customIsIncluded && !customIsExcluded) {\n              this.addCustomToPool(custom, pool);\n            }\n          }\n        }\n\n        allResults = values.map(function (value) {\n          var aPool = pool,\n              aIndex = _this4.index,\n              length = 0;\n\n          for (var charIndex = 0; charIndex < value.length; charIndex++) {\n            var char = value[charIndex];\n            length++;\n            aIndex[char] || (aIndex[char] = {});\n            aIndex = aIndex[char];\n\n            if (!aIndex.results) {\n              (function () {\n                var scores = {};\n                aIndex.results = [];\n                aIndex.pool = {};\n\n                for (var _id in aPool) {\n                  var emoji = aPool[_id];\n                  var search = emoji.search;\n                  var sub = value.substr(0, length);\n                  var subIndex = search.indexOf(sub);\n\n                  if (subIndex != -1) {\n                    var score = subIndex + 1;\n                    if (sub == _id) score = 0;\n\n                    if (_this4.emojis[_id] && _this4.emojis[_id][skinTone]) {\n                      aIndex.results.push(_this4.emojis[_id][skinTone]);\n                    } else {\n                      aIndex.results.push(_this4.emojis[_id]);\n                    }\n\n                    aIndex.pool[_id] = emoji;\n                    scores[_id] = score;\n                  }\n                }\n\n                aIndex.results.sort(function (a, b) {\n                  var aScore = scores[a.id],\n                      bScore = scores[b.id];\n\n                  if (aScore == bScore) {\n                    return a.id.localeCompare(b.id);\n                  } else {\n                    return aScore - bScore;\n                  }\n                });\n              })();\n            }\n\n            aPool = aIndex.pool;\n          }\n\n          return aIndex.results;\n        }).filter(function (a) {\n          return a;\n        });\n\n        if (allResults.length > 1) {\n          results = intersect.apply(null, allResults);\n        } else if (allResults.length) {\n          results = allResults[0];\n        } else {\n          results = [];\n        }\n      }\n\n      if (results) {\n        if (emojisToShowFilter) {\n          results = results.filter(function (result) {\n            return emojisToShowFilter(pool[result.id]);\n          });\n        }\n\n        if (results && results.length > maxResults) {\n          results = results.slice(0, maxResults);\n        }\n      }\n\n      return results;\n    }\n  }]);\n\n  return NimbleEmojiIndex;\n}();\n\nexport default NimbleEmojiIndex;","map":{"version":3,"sources":["/Users/matthewchang/workspace/github/SEM2020/store-owner-console/node_modules/emoji-mart/dist-es/utils/emoji-index/nimble-emoji-index.js"],"names":["_classCallCheck","_createClass","getData","getSanitizedData","intersect","uncompress","store","NimbleEmojiIndex","data","set","compressed","originalPool","index","emojis","emoticons","customEmojisList","buildIndex","key","value","_this","_loop","emoji","emojiData","short_names","skin_variations","id","forEach","emoticon","skinTone","skin","clearCustomEmojis","pool","_this2","emojiId","addCustomToPool","custom","_this3","length","search","_this4","_ref","arguments","undefined","emojisToShowFilter","maxResults","include","exclude","_ref$custom","get","results","values","toLowerCase","split","allResults","categories","category","isIncluded","indexOf","isExcluded","customIsIncluded","customIsExcluded","map","aPool","aIndex","charIndex","char","scores","_id","sub","substr","subIndex","score","push","sort","a","b","aScore","bScore","localeCompare","filter","apply","result","slice"],"mappings":"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","sourcesContent":["import _classCallCheck from '../../polyfills/classCallCheck';\nimport _createClass from '../../polyfills/createClass';\nimport { getData, getSanitizedData, intersect } from '..';\nimport { uncompress } from '../data';\nimport store from '../store';\n\nvar NimbleEmojiIndex = function () {\n  function NimbleEmojiIndex(data, set) {\n    _classCallCheck(this, NimbleEmojiIndex);\n\n    if (data.compressed) {\n      uncompress(data);\n    }\n\n    this.data = data || {};\n    this.set = set || null;\n    this.originalPool = {};\n    this.index = {};\n    this.emojis = {};\n    this.emoticons = {};\n    this.customEmojisList = [];\n\n    this.buildIndex();\n  }\n\n  _createClass(NimbleEmojiIndex, [{\n    key: 'buildIndex',\n    value: function buildIndex() {\n      var _this = this;\n\n      var _loop = function _loop(emoji) {\n        var emojiData = _this.data.emojis[emoji];\n        var short_names = emojiData.short_names;\n        var emoticons = emojiData.emoticons;\n        var skin_variations = emojiData.skin_variations;\n        var id = short_names[0];\n\n        if (emoticons) {\n          emoticons.forEach(function (emoticon) {\n            if (_this.emoticons[emoticon]) {\n              return;\n            }\n\n            _this.emoticons[emoticon] = id;\n          });\n        }\n\n        // If skin variations include them\n        if (skin_variations) {\n          _this.emojis[id] = {};\n          for (var skinTone = 1; skinTone <= 6; skinTone++) {\n            _this.emojis[id][skinTone] = getSanitizedData({ id: id, skin: skinTone }, skinTone, _this.set, _this.data);\n          }\n        } else {\n          _this.emojis[id] = getSanitizedData(id, null, _this.set, _this.data);\n        }\n\n        _this.originalPool[id] = emojiData;\n      };\n\n      for (var emoji in this.data.emojis) {\n        _loop(emoji);\n      }\n    }\n  }, {\n    key: 'clearCustomEmojis',\n    value: function clearCustomEmojis(pool) {\n      var _this2 = this;\n\n      this.customEmojisList.forEach(function (emoji) {\n        var emojiId = emoji.id || emoji.short_names[0];\n\n        delete pool[emojiId];\n        delete _this2.emojis[emojiId];\n      });\n    }\n  }, {\n    key: 'addCustomToPool',\n    value: function addCustomToPool(custom, pool) {\n      var _this3 = this;\n\n      if (this.customEmojisList.length) this.clearCustomEmojis(pool);\n\n      custom.forEach(function (emoji) {\n        var emojiId = emoji.id || emoji.short_names[0];\n\n        if (emojiId && !pool[emojiId]) {\n          pool[emojiId] = getData(emoji, null, null, _this3.data);\n          _this3.emojis[emojiId] = getSanitizedData(emoji, null, null, _this3.data);\n        }\n      });\n\n      this.customEmojisList = custom;\n      this.index = {};\n    }\n  }, {\n    key: 'search',\n    value: function search(value) {\n      var _this4 = this;\n\n      var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n      var emojisToShowFilter = _ref.emojisToShowFilter;\n      var maxResults = _ref.maxResults;\n      var include = _ref.include;\n      var exclude = _ref.exclude;\n      var _ref$custom = _ref.custom;\n      var custom = _ref$custom === undefined ? [] : _ref$custom;\n\n      if (this.customEmojisList != custom) this.addCustomToPool(custom, this.originalPool);\n\n      var skinTone = store.get('skin') || 1;\n\n      maxResults || (maxResults = 75);\n      include || (include = []);\n      exclude || (exclude = []);\n\n      var results = null,\n          pool = this.originalPool;\n\n      if (value.length) {\n        if (value == '-' || value == '-1') {\n          return [this.emojis['-1'][skinTone]];\n        }\n\n        var values = value.toLowerCase().split(/[\\s|,|\\-|_]+/),\n            allResults = [];\n\n        if (values.length > 2) {\n          values = [values[0], values[1]];\n        }\n\n        if (include.length || exclude.length) {\n          pool = {};\n\n          this.data.categories.forEach(function (category) {\n            var isIncluded = include && include.length ? include.indexOf(category.id) > -1 : true;\n            var isExcluded = exclude && exclude.length ? exclude.indexOf(category.id) > -1 : false;\n            if (!isIncluded || isExcluded) {\n              return;\n            }\n\n            category.emojis.forEach(function (emojiId) {\n              return pool[emojiId] = _this4.data.emojis[emojiId];\n            });\n          });\n\n          if (custom.length) {\n            var customIsIncluded = include && include.length ? include.indexOf('custom') > -1 : true;\n            var customIsExcluded = exclude && exclude.length ? exclude.indexOf('custom') > -1 : false;\n            if (customIsIncluded && !customIsExcluded) {\n              this.addCustomToPool(custom, pool);\n            }\n          }\n        }\n\n        allResults = values.map(function (value) {\n          var aPool = pool,\n              aIndex = _this4.index,\n              length = 0;\n\n          for (var charIndex = 0; charIndex < value.length; charIndex++) {\n            var char = value[charIndex];\n            length++;\n\n            aIndex[char] || (aIndex[char] = {});\n            aIndex = aIndex[char];\n\n            if (!aIndex.results) {\n              (function () {\n                var scores = {};\n\n                aIndex.results = [];\n                aIndex.pool = {};\n\n                for (var _id in aPool) {\n                  var emoji = aPool[_id];\n                  var search = emoji.search;\n                  var sub = value.substr(0, length);\n                  var subIndex = search.indexOf(sub);\n\n                  if (subIndex != -1) {\n                    var score = subIndex + 1;\n                    if (sub == _id) score = 0;\n\n                    if (_this4.emojis[_id] && _this4.emojis[_id][skinTone]) {\n                      aIndex.results.push(_this4.emojis[_id][skinTone]);\n                    } else {\n                      aIndex.results.push(_this4.emojis[_id]);\n                    }\n                    aIndex.pool[_id] = emoji;\n\n                    scores[_id] = score;\n                  }\n                }\n\n                aIndex.results.sort(function (a, b) {\n                  var aScore = scores[a.id],\n                      bScore = scores[b.id];\n\n                  if (aScore == bScore) {\n                    return a.id.localeCompare(b.id);\n                  } else {\n                    return aScore - bScore;\n                  }\n                });\n              })();\n            }\n\n            aPool = aIndex.pool;\n          }\n\n          return aIndex.results;\n        }).filter(function (a) {\n          return a;\n        });\n\n        if (allResults.length > 1) {\n          results = intersect.apply(null, allResults);\n        } else if (allResults.length) {\n          results = allResults[0];\n        } else {\n          results = [];\n        }\n      }\n\n      if (results) {\n        if (emojisToShowFilter) {\n          results = results.filter(function (result) {\n            return emojisToShowFilter(pool[result.id]);\n          });\n        }\n\n        if (results && results.length > maxResults) {\n          results = results.slice(0, maxResults);\n        }\n      }\n\n      return results;\n    }\n  }]);\n\n  return NimbleEmojiIndex;\n}();\n\nexport default NimbleEmojiIndex;"]},"metadata":{},"sourceType":"module"}