{"ast":null,"code":"import _classCallCheck from\"/Users/matthewchang/workspace/github/SEM2020/store-owner-console/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/matthewchang/workspace/github/SEM2020/store-owner-console/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/matthewchang/workspace/github/SEM2020/store-owner-console/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/matthewchang/workspace/github/SEM2020/store-owner-console/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import React from\"react\";import firebase from\"../../firebase\";import AvatarEditor from\"react-avatar-editor\";// prettier-ignore\nimport{Grid,Header,Icon,Dropdown,Image,Modal,Input,Button}from\"semantic-ui-react\";var UserPanel=/*#__PURE__*/function(_React$Component){_inherits(UserPanel,_React$Component);var _super=_createSuper(UserPanel);function UserPanel(){var _this;_classCallCheck(this,UserPanel);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={user:_this.props.currentUser,storeName:\"\",modal:false,previewImage:\"\",croppedImage:\"\",blob:null,uploadedCroppedImage:\"\",storageRef:firebase.storage().ref(),userRef:firebase.auth().currentUser,usersRef:firebase.database().ref(\"users\"),metadata:{contentType:\"image/jpeg\"}};_this.openModal=function(){return _this.setState({modal:true});};_this.closeModal=function(){return _this.setState({modal:false});};_this.dropdownOptions=function(){return[{key:\"user\",text:/*#__PURE__*/_jsxs(\"span\",{children:[\"Signed in as \",/*#__PURE__*/_jsx(\"strong\",{children:_this.state.user.displayName})]}),disabled:true},{key:\"avatar\",text:/*#__PURE__*/_jsx(\"span\",{onClick:_this.openModal,children:\"Change Avatar\"})},{key:\"signout\",text:/*#__PURE__*/_jsx(\"span\",{onClick:_this.handleSignout,children:\"Sign Out\"})}];};_this.uploadCroppedImage=function(){var _this$state=_this.state,storageRef=_this$state.storageRef,userRef=_this$state.userRef,blob=_this$state.blob,metadata=_this$state.metadata;storageRef.child(\"avatars/users/\".concat(userRef.uid)).put(blob,metadata).then(function(snap){snap.ref.getDownloadURL().then(function(downloadURL){_this.setState({uploadedCroppedImage:downloadURL},function(){return _this.changeAvatar();});});});};_this.changeAvatar=function(){_this.state.userRef.updateProfile({photoURL:_this.state.uploadedCroppedImage}).then(function(){console.log(\"PhotoURL updated\");_this.closeModal();}).catch(function(err){console.error(err);});_this.state.usersRef.child(_this.state.user.uid).update({avatar:_this.state.uploadedCroppedImage}).then(function(){console.log(\"User avatar updated\");}).catch(function(err){console.error(err);});};_this.handleChange=function(event){var file=event.target.files[0];var reader=new FileReader();if(file){reader.readAsDataURL(file);reader.addEventListener(\"load\",function(){_this.setState({previewImage:reader.result});});}};_this.handleCropImage=function(){if(_this.avatarEditor){_this.avatarEditor.getImageScaledToCanvas().toBlob(function(blob){var imageUrl=URL.createObjectURL(blob);_this.setState({croppedImage:imageUrl,blob:blob});});}};_this.handleSignout=function(){firebase.auth().signOut().then(function(){return console.log(\"signed out!\");});};return _this;}_createClass(UserPanel,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;this.state.usersRef.child(this.props.currentUser.uid).once('value').then(function(snapshot){_this2.setState({storeName:snapshot.val()&&snapshot.val().storeName||'',twilioNumber:snapshot.val()&&snapshot.val().twilioNumber||'',items:snapshot.val()&&snapshot.val().items||[],promotions:snapshot.val()&&snapshot.val().promotions||[]});});}},{key:\"render\",value:function render(){var _this3=this;var _this$state2=this.state,_this$state2$storeNam=_this$state2.storeName,storeName=_this$state2$storeNam===void 0?[]:_this$state2$storeNam,_this$state2$items=_this$state2.items,items=_this$state2$items===void 0?[]:_this$state2$items,promotions=_this$state2.promotions,twilioNumber=_this$state2.twilioNumber,user=_this$state2.user,modal=_this$state2.modal,previewImage=_this$state2.previewImage,croppedImage=_this$state2.croppedImage;var primaryColor=this.props.primaryColor;return/*#__PURE__*/_jsx(Grid,{style:{background:primaryColor},children:/*#__PURE__*/_jsxs(Grid.Column,{children:[/*#__PURE__*/_jsxs(Grid.Row,{style:{padding:\"1.2em\",margin:0},children:[/*#__PURE__*/_jsxs(Header,{inverted:true,floated:\"left\",as:\"h2\",children:[/*#__PURE__*/_jsx(Icon,{name:\"headphones\"}),/*#__PURE__*/_jsx(Header.Content,{children:\"IVRobot\"})]}),/*#__PURE__*/_jsx(Header,{inverted:true,floated:\"left\",as:\"h3\",children:storeName}),/*#__PURE__*/_jsxs(Header,{inverted:true,floated:\"left\",as:\"h6\",children:[\"Phone Number: \",twilioNumber,/*#__PURE__*/_jsx(\"br\",{})]}),/*#__PURE__*/_jsxs(Header,{inverted:true,floated:\"left\",as:\"h6\",children:[\"Items:\",/*#__PURE__*/_jsx(\"br\",{}),items.map(function(i,idx){return/*#__PURE__*/_jsxs(\"p\",{children:[i.name,\"(\",i.stock,\")\"]},idx);})]}),/*#__PURE__*/_jsx(Header,{style:{padding:\"0.25em\"},as:\"h4\",inverted:true,children:/*#__PURE__*/_jsx(Dropdown,{trigger:/*#__PURE__*/_jsxs(\"span\",{children:[/*#__PURE__*/_jsx(Image,{src:user.photoURL,spaced:\"right\",avatar:true}),user.displayName]}),options:this.dropdownOptions()})})]}),/*#__PURE__*/_jsxs(Modal,{basic:true,open:modal,onClose:this.closeModal,children:[/*#__PURE__*/_jsx(Modal.Header,{children:\"Change Avatar\"}),/*#__PURE__*/_jsxs(Modal.Content,{children:[/*#__PURE__*/_jsx(Input,{onChange:this.handleChange,fluid:true,type:\"file\",label:\"New Avatar\",name:\"previewImage\"}),/*#__PURE__*/_jsx(Grid,{centered:true,stackable:true,columns:2,children:/*#__PURE__*/_jsxs(Grid.Row,{centered:true,children:[/*#__PURE__*/_jsx(Grid.Column,{className:\"ui center aligned grid\",children:previewImage&&/*#__PURE__*/_jsx(AvatarEditor,{ref:function ref(node){return _this3.avatarEditor=node;},image:previewImage,width:120,height:120,border:50,scale:1.2})}),/*#__PURE__*/_jsx(Grid.Column,{children:croppedImage&&/*#__PURE__*/_jsx(Image,{style:{margin:\"3.5em auto\"},width:100,height:100,src:croppedImage})})]})})]}),/*#__PURE__*/_jsxs(Modal.Actions,{children:[croppedImage&&/*#__PURE__*/_jsxs(Button,{color:\"green\",inverted:true,onClick:this.uploadCroppedImage,children:[/*#__PURE__*/_jsx(Icon,{name:\"save\"}),\" Change Avatar\"]}),/*#__PURE__*/_jsxs(Button,{color:\"green\",inverted:true,onClick:this.handleCropImage,children:[/*#__PURE__*/_jsx(Icon,{name:\"image\"}),\" Preview\"]}),/*#__PURE__*/_jsxs(Button,{color:\"red\",inverted:true,onClick:this.closeModal,children:[/*#__PURE__*/_jsx(Icon,{name:\"remove\"}),\" Cancel\"]})]})]})]})});}}]);return UserPanel;}(React.Component);export default UserPanel;","map":{"version":3,"sources":["/Users/matthewchang/workspace/github/SEM2020/store-owner-console/src/components/SidePanel/UserPanel.js"],"names":["React","firebase","AvatarEditor","Grid","Header","Icon","Dropdown","Image","Modal","Input","Button","UserPanel","state","user","props","currentUser","storeName","modal","previewImage","croppedImage","blob","uploadedCroppedImage","storageRef","storage","ref","userRef","auth","usersRef","database","metadata","contentType","openModal","setState","closeModal","dropdownOptions","key","text","displayName","disabled","handleSignout","uploadCroppedImage","child","uid","put","then","snap","getDownloadURL","downloadURL","changeAvatar","updateProfile","photoURL","console","log","catch","err","error","update","avatar","handleChange","event","file","target","files","reader","FileReader","readAsDataURL","addEventListener","result","handleCropImage","avatarEditor","getImageScaledToCanvas","toBlob","imageUrl","URL","createObjectURL","signOut","once","snapshot","val","twilioNumber","items","promotions","primaryColor","background","padding","margin","map","i","idx","name","stock","node","Component"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport firebase from \"../../firebase\";\nimport AvatarEditor from \"react-avatar-editor\";\n// prettier-ignore\nimport { Grid, Header, Icon, Dropdown, Image, Modal, Input, Button } from \"semantic-ui-react\";\n\nclass UserPanel extends React.Component {\n  state = {\n    user: this.props.currentUser,\n    storeName: \"\",\n    modal: false,\n    previewImage: \"\",\n    croppedImage: \"\",\n    blob: null,\n    uploadedCroppedImage: \"\",\n    storageRef: firebase.storage().ref(),\n    userRef: firebase.auth().currentUser,\n    usersRef: firebase.database().ref(\"users\"),\n    metadata: {\n      contentType: \"image/jpeg\"\n    }\n  };\n\n  openModal = () => this.setState({ modal: true });\n\n  closeModal = () => this.setState({ modal: false });\n\n  dropdownOptions = () => [\n    {\n      key: \"user\",\n      text: (\n        <span>\n          Signed in as <strong>{this.state.user.displayName}</strong>\n        </span>\n      ),\n      disabled: true\n    },\n    {\n      key: \"avatar\",\n      text: <span onClick={this.openModal}>Change Avatar</span>\n    },\n    {\n      key: \"signout\",\n      text: <span onClick={this.handleSignout}>Sign Out</span>\n    }\n  ];\n\n  uploadCroppedImage = () => {\n    const { storageRef, userRef, blob, metadata } = this.state;\n\n    storageRef\n      .child(`avatars/users/${userRef.uid}`)\n      .put(blob, metadata)\n      .then(snap => {\n        snap.ref.getDownloadURL().then(downloadURL => {\n          this.setState({ uploadedCroppedImage: downloadURL }, () =>\n            this.changeAvatar()\n          );\n        });\n      });\n  };\n\n  changeAvatar = () => {\n    this.state.userRef\n      .updateProfile({\n        photoURL: this.state.uploadedCroppedImage\n      })\n      .then(() => {\n        console.log(\"PhotoURL updated\");\n        this.closeModal();\n      })\n      .catch(err => {\n        console.error(err);\n      });\n\n    this.state.usersRef\n      .child(this.state.user.uid)\n      .update({ avatar: this.state.uploadedCroppedImage })\n      .then(() => {\n        console.log(\"User avatar updated\");\n      })\n      .catch(err => {\n        console.error(err);\n      });\n  };\n\n  handleChange = event => {\n    const file = event.target.files[0];\n    const reader = new FileReader();\n\n    if (file) {\n      reader.readAsDataURL(file);\n      reader.addEventListener(\"load\", () => {\n        this.setState({ previewImage: reader.result });\n      });\n    }\n  };\n\n  handleCropImage = () => {\n    if (this.avatarEditor) {\n      this.avatarEditor.getImageScaledToCanvas().toBlob(blob => {\n        let imageUrl = URL.createObjectURL(blob);\n        this.setState({\n          croppedImage: imageUrl,\n          blob\n        });\n      });\n    }\n  };\n\n  handleSignout = () => {\n    firebase\n      .auth()\n      .signOut()\n      .then(() => console.log(\"signed out!\"));\n  };\n\n  componentDidMount(){\n    this.state.usersRef.child(this.props.currentUser.uid).once('value').then(snapshot => {\n      this.setState({\n        storeName: snapshot.val() && snapshot.val().storeName || '',\n        twilioNumber: snapshot.val() && snapshot.val().twilioNumber || '',\n        items:  snapshot.val() && snapshot.val().items || [],\n        promotions:  snapshot.val() && snapshot.val().promotions || [],\n      })\n    })\n  }\n\n  render() {\n    const { storeName = [], items = [], promotions, twilioNumber, user, modal, previewImage, croppedImage } = this.state;\n    const { primaryColor } = this.props;\n\n    return (\n      <Grid style={{ background: primaryColor }}>\n        <Grid.Column>\n          <Grid.Row style={{ padding: \"1.2em\", margin: 0 }}>\n            {/* App Header */}\n            <Header inverted floated=\"left\" as=\"h2\">\n              <Icon name=\"headphones\" />\n              <Header.Content>IVRobot</Header.Content>\n              \n            </Header>\n            <Header inverted floated=\"left\" as=\"h3\">\n              {storeName}\n            </Header>\n            <Header inverted floated=\"left\" as=\"h6\">\n              Phone Number: {twilioNumber}<br/>\n            </Header>\n\n            <Header inverted floated=\"left\" as=\"h6\">\n              Items:<br/>\n              {items.map((i, idx) => <p key={idx}>{i.name}({i.stock})</p>)}\n            </Header>\n\n            {/* User Dropdown  */}\n            <Header style={{ padding: \"0.25em\" }} as=\"h4\" inverted>\n              <Dropdown\n                trigger={\n                  <span>\n                    <Image src={user.photoURL} spaced=\"right\" avatar />\n                    {user.displayName}\n                  </span>\n                }\n                options={this.dropdownOptions()}\n              />\n            </Header>\n          </Grid.Row>\n\n          {/* Change User Avatar Modal   */}\n          <Modal basic open={modal} onClose={this.closeModal}>\n            <Modal.Header>Change Avatar</Modal.Header>\n            <Modal.Content>\n              <Input\n                onChange={this.handleChange}\n                fluid\n                type=\"file\"\n                label=\"New Avatar\"\n                name=\"previewImage\"\n              />\n              <Grid centered stackable columns={2}>\n                <Grid.Row centered>\n                  <Grid.Column className=\"ui center aligned grid\">\n                    {previewImage && (\n                      <AvatarEditor\n                        ref={node => (this.avatarEditor = node)}\n                        image={previewImage}\n                        width={120}\n                        height={120}\n                        border={50}\n                        scale={1.2}\n                      />\n                    )}\n                  </Grid.Column>\n                  <Grid.Column>\n                    {croppedImage && (\n                      <Image\n                        style={{ margin: \"3.5em auto\" }}\n                        width={100}\n                        height={100}\n                        src={croppedImage}\n                      />\n                    )}\n                  </Grid.Column>\n                </Grid.Row>\n              </Grid>\n            </Modal.Content>\n            <Modal.Actions>\n              {croppedImage && (\n                <Button\n                  color=\"green\"\n                  inverted\n                  onClick={this.uploadCroppedImage}\n                >\n                  <Icon name=\"save\" /> Change Avatar\n                </Button>\n              )}\n              <Button color=\"green\" inverted onClick={this.handleCropImage}>\n                <Icon name=\"image\" /> Preview\n              </Button>\n              <Button color=\"red\" inverted onClick={this.closeModal}>\n                <Icon name=\"remove\" /> Cancel\n              </Button>\n            </Modal.Actions>\n          </Modal>\n        </Grid.Column>\n      </Grid>\n    );\n  }\n}\n\nexport default UserPanel;\n"]},"metadata":{},"sourceType":"module"}